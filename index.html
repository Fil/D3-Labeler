<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.dot {
  stroke: #000;
}

.circ {
  stroke: #000;
}

.axis_label {
  font: 10px sans-serif;
}

.label {
  font: 10px sans-serif;
}

.link { stroke:gray;stroke-width:0.5}

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="anneal.js"></script>
<script>

    var anchor = [],
        label_centers = [];

    var anchor = [],
        label_centers = [],
        margin = {top: 20, right: 20, bottom: 30, left: 10},
        width = 560 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom,
        x_mean = width/2,
        x_std = width/4,
        y_mean = height/2,
        y_std = height/4,
        offset = 4;

    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Functions
    function redrawLabels(label_centers) {
        labels
        .transition()
        .duration(1000)
        .attr("x", function(d) { return (d.x); })
        .attr("y", function(d) { return (d.y); });

        links
        .transition()
        .duration(1000)
        .attr("x2",function(d) { return (d.x); })
        .attr("y2",function(d) { return (d.y); });

        circ
        .transition()
        .duration(1000)
        .attr("cx",function(d) { return (d.x); })
        .attr("cy",function(d) { return (d.y - offset); });
    }

    function randomize(count) {
        for (var i = 0; i < count; i++) {
            var xval=x_mean + (2 * Math.random() - 1.0) * x_std;
            var yval=y_mean + (2 * Math.random() - 1.0) * y_std;
            anchor.push({x: xval, y: yval, name: "Node "+String(i)});
        }
    }
    randomize(30)

    // Draw data points
    anchor_data = svg.selectAll(".dot")
        .data(anchor)
        .enter().append("circle")
        .attr("class", "dot")
        .attr("r", 4.0)
        .attr("cx", function(d) { return (d.x); })
        .attr("cy", function(d) { return (d.y); })
        .style("fill", 'red');

    anchor_data.each(function(d, i) {
        label_centers.push({x: d.x, y: d.y, name: d.name});
    });

    // Draw labels
    labels = svg.selectAll(".label")
        .data(label_centers)
        .enter()
        .append("text")
        .attr('text-anchor', 'middle')
        .text(function(d) { return d.name; })
        .attr("x", function(d) { return (d.x); })
        .attr("y", function(d) { return (d.y); })
        .attr("fill", "black");

    // Draw data points
    circ = svg.selectAll(".circ")
        .data(label_centers)
        .enter().append("circle")
        .attr("class", "circ")
        .attr("r", 20.0)
        .attr("cx", function(d) { return (d.x); })
        .attr("cy", function(d) { return (d.y - offset); })
        .style("fill", 'red')
        .attr('opacity',0.0);

    // Draw links
    links = svg.selectAll(".link")
        .data(label_centers)
        .enter()
        .append("line")
        .attr("x1", function(d) { return (d.x); })
        .attr("y1", function(d) { return (d.y); })
        .attr("x2", function(d) { return (d.x); })
        .attr("y2", function(d) { return (d.y); })
        .attr("stroke-width", 0.5)
        .attr("stroke", "gray");

    var chart = d3.anneal()
            .nodes(label_centers)
            .anchor(anchor)
            .width(width).height(height)
            .sim_anneal(0.1);
    
    redrawLabels()
    
</script>